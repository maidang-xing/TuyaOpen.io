"use strict";(self.webpackChunktuyaopen_io_website=self.webpackChunktuyaopen_io_website||[]).push([["9710"],{2228:function(e,t,n){n.r(t),n.d(t,{metadata:()=>a,default:()=>h,frontMatter:()=>o,contentTitle:()=>s,toc:()=>d,assets:()=>l});var a=JSON.parse('{"id":"new-hardware/porting-platform","title":"Porting platform","description":"This document helps you understand which materials to read, how to operate, and how to verify successful adaptation when adding a new chip to TuyaOpen.","source":"@site/docs/new-hardware/porting-platform.md","sourceDirName":"new-hardware","slug":"/new-hardware/porting-platform","permalink":"/docs/new-hardware/porting-platform","draft":false,"unlisted":false,"editUrl":"https://github.com/Tuya-Community/TuyaOpen.io/edit/master/docs/new-hardware/porting-platform.md","tags":[],"version":"current","frontMatter":{"title":"Porting platform"},"sidebar":"docs","previous":{"title":"Button Driver","permalink":"/docs/peripheral/button"},"next":{"title":"Create platform","permalink":"/docs/new-hardware/new-platform"}}'),r=n(4848),i=n(8453);let o={title:"Porting platform"},s,l={},d=[{value:"Create Platform",id:"create-platform",level:2},{value:"tkl Layer Adaptation",id:"tkl-layer-adaptation",level:2},{value:"Create Board",id:"create-board",level:2},{value:"Function Verification",id:"function-verification",level:2}];function c(e){let t={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"This document helps you understand which materials to read, how to operate, and how to verify successful adaptation when adding a new chip to TuyaOpen."}),"\n",(0,r.jsxs)(t.p,{children:["For users new to TuyaOpen, it is recommended to first read the ",(0,r.jsx)(t.a,{href:"/docs/quick-start/",children:"Quick Start"})," guide, follow the tutorial to set up and experience the switch_demo application (Ubuntu environment is recommended), and get familiar with Tuya IoT's network configuration and operation logic. You should also read the ",(0,r.jsx)(t.a,{href:"/docs/tos-tools/tos-guide",children:"tos.py User Guide"})," to understand how to use ",(0,r.jsx)(t.code,{children:"tos.py"})," and the functions of each command."]}),"\n",(0,r.jsx)(t.p,{children:"Before starting chip adaptation, it is recommended to briefly understand the TuyaOpen build process:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"First, compile the application (for example, switch_demo under TuyaOpen/apps/tuya_cloud/switch_demo) and the TuyaOpen source code (TuyaOpen/src directory) to generate the application static library (libtuyaapp.a) and SDK static library (libtuyaos.a)."}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Use the ",(0,r.jsx)(t.code,{children:"platform/Ubuntu/build_example.py"})," script to call the original manufacturer's build and link commands, and finally generate three types of firmware: QIO, UA, and UG."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Firmware Name"}),(0,r.jsx)(t.th,{style:{textAlign:"center"},children:"Firmware Type"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"app_name_QIO_1.0.0"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"bootload + user area"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"app_name_UA_1.0.0"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"user area"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"app_name_UG_1.0.0"}),(0,r.jsx)(t.td,{style:{textAlign:"center"},children:"upgrade"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["For detailed build steps, refer to the ",(0,r.jsx)(t.a,{href:"/docs/build-system/compilation-guide",children:"TuyaOpen Build Process Explained"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Generally, adapting a new chip on TuyaOpen involves the following steps:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Create a new platform, complete toolchain download and build/link scripts"}),"\n",(0,r.jsx)(t.li,{children:"Complete tkl layer adaptation"}),"\n",(0,r.jsx)(t.li,{children:"Create a new board"}),"\n",(0,r.jsx)(t.li,{children:"Improve configuration and test functions in the apps/tuya_cloud/switch_demo project to verify successful adaptation"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"create-platform",children:"Create Platform"}),"\n",(0,r.jsxs)(t.p,{children:["For the detailed process of creating a new platform, ",(0,r.jsx)(t.a,{href:"/docs/new-hardware/new-platform",children:"click here for more information"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["In the ",(0,r.jsx)(t.code,{children:"menuconfig"})," configuration interface, pay special attention to the following two options. Other options should be selected according to your hardware:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"ENABLE_FLASH"}),": ",(0,r.jsx)(t.strong,{children:"Must be enabled"}),". Developers need to reserve an unused flash area for TuyaOpen, avoiding the firmware area and matching the flash erase granularity."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.code,{children:"ENABLE_FILE_SYSTEM"}),": If you want to use the original SDK's file system, please adapt the ",(0,r.jsx)(t.code,{children:"tkl_fs.c"})," file. If disabled, TuyaOpen's built-in littlefs file system will be used, with its address and size configured and provided by ",(0,r.jsx)(t.code,{children:"tkl_flash.c"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(t.admonition,{type:"warning",children:[(0,r.jsx)(t.p,{children:"Why do you need to reserve an unused flash area?"}),(0,r.jsx)(t.p,{children:"Both TuyaOpen and TuyaOS require storage for device authorization information, and after successful network configuration and activation, some device information and keys must also be stored in flash. To ensure file system power-down safety, TuyaOpen uses open-source littlefs + aec128 cbc, while TuyaOS uses a self-developed kv file system, both of which are secure and reliable. For security and stability, and to allow developers to quickly switch SDKs between TuyaOpen and TuyaOS (the tkl adaptation layer interfaces are consistent), it is necessary to reserve an unused flash area for TuyaOpen."})]}),"\n",(0,r.jsx)(t.h2,{id:"tkl-layer-adaptation",children:"tkl Layer Adaptation"}),"\n",(0,r.jsxs)(t.p,{children:["For tkl layer adaptation, developers can refer to the ",(0,r.jsx)(t.a,{href:"/docs/new-hardware/new-platform#fill-in-the-code",children:"supplementary code"})," and ",(0,r.jsx)(t.a,{href:"https://developer.tuya.com/en/docs/iot-device-dev/TuyaOS-translation_rtos?id=Kcrwraf21847l",children:"Porting TuyaOS to RTOS Platform"})," documents for adaptation and improvement. Note that the original SDK may already integrate lwip and mbedtls; you can choose to use either the original or TuyaOpen's version as needed. To select, open the visual configuration interface by running ",(0,r.jsx)(t.code,{children:"tos.py config menu"})," in the ",(0,r.jsx)(t.code,{children:"apps/tuya_cloud/switch_demo"})," directory."]}),"\n",(0,r.jsxs)(t.p,{children:["Whether to enable TuyaOpen lwip functionality can be set in ",(0,r.jsx)(t.code,{children:"configure tuyaopen \u2192 configure enable/disable liblwip"}),"."]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["If this option is disabled, you need to adapt ",(0,r.jsx)(t.code,{children:"tkl_network.c"})," to use the original lwip. You can refer to ",(0,r.jsx)(t.a,{href:"https://github.com/tuya/TuyaOpen-esp32/blob/master/tuya_open_sdk/tuyaos_adapter/src/drivers/tkl_network.c",children:"TuyaOpen-ESP32"})," for adaptation; this uses the original lwip."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["If this option is enabled, you need to adapt ",(0,r.jsx)(t.code,{children:"tkl_lwip.c"})," to use TuyaOpen's lwip. You can refer to ",(0,r.jsx)(t.a,{href:"https://github.com/tuya/TuyaOpen-T2/blob/master/tuyaos/tuyaos_adapter/src/tkl_lwip.c",children:"TuyaOpen-T2"})," for adaptation; this uses TuyaOpen's lwip."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["Choose one of these two files to adapt according to your configuration. For details, refer to the ",(0,r.jsx)(t.a,{href:"https://developer.tuya.com/en/docs/iot-device-dev/TuyaOS-translation_rtos?id=Kcrwraf21847l#title-16-Adapt%20the%20network%20interface",children:"Network Interface Adaptation"})," documentation."]}),"\n",(0,r.jsxs)(t.p,{children:["Whether to enable TuyaOpen mbedtls functionality can be set in ",(0,r.jsx)(t.code,{children:"configure tuyaopen \u2192 configure mbedtls \u2192 Enable user custom"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"Cellular Network tkl Interface Adaptation:"}),"\n",(0,r.jsxs)(t.p,{children:["To support this feature, you need to enable the ",(0,r.jsx)(t.code,{children:"ENABLE_CELLULAR"})," option when creating the platform template. The minimum adaptation file list for the cellular network part is as follows:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"tkl_cellular_base.c"}),"\n",(0,r.jsx)(t.li,{children:"tkl_cellular_comm.c"}),"\n",(0,r.jsx)(t.li,{children:"tkl_cellular_mds.c"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["For cellular network chips, TuyaOpen has adapted the L511C module. Developers can download the ",(0,r.jsx)(t.a,{href:"https://github.com/tuya/TuyaOpen/tree/dev-cellular",children:"TuyaOpen dev-cellular branch"})," for reference or directly use the L511C module. The platform repository for L511C is: ",(0,r.jsx)(t.a,{href:"https://github.com/shiliu-yang/TuyaOpen-L511C/tree/dev",children:"https://github.com/shiliu-yang/TuyaOpen-L511C/tree/dev"})]}),"\n",(0,r.jsx)(t.p,{children:"Cellular network chip adaptation developers can base their work on TuyaOpen dev-cellular or dev branches."}),"\n",(0,r.jsx)(t.h2,{id:"create-board",children:"Create Board"}),"\n",(0,r.jsxs)(t.p,{children:["For steps to create a board, refer to the ",(0,r.jsx)(t.a,{href:"/docs/new-hardware/new-board",children:"Create Board"})," section."]}),"\n",(0,r.jsxs)(t.p,{children:["After the board is created and ",(0,r.jsx)(t.a,{href:"/docs/new-hardware/new-board#adjust-configuration",children:"configuration is adjusted"})," and ",(0,r.jsx)(t.a,{href:"/docs/new-hardware/new-board#save-configuration",children:"saved"}),", you can select the corresponding development board in the ",(0,r.jsx)(t.code,{children:"apps/tuya_cloud/switch_demo"})," directory using the ",(0,r.jsx)(t.code,{children:"tos.py config choice"})," command, and then proceed to the next step to verify functionality."]}),"\n",(0,r.jsx)(t.h2,{id:"function-verification",children:"Function Verification"}),"\n",(0,r.jsxs)(t.p,{children:["Before compiling the switch_demo code with ",(0,r.jsx)(t.code,{children:"tos.py build"}),", please ensure the following:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"tuya_app_main()"})," function in ",(0,r.jsx)(t.code,{children:"apps/tuya_cloud/switch_demo/src/tuya_main.c"})," has been called in the original SDK."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Update the authorization macros ",(0,r.jsx)(t.code,{children:"TUYA_OPENSDK_UUID"})," and ",(0,r.jsx)(t.code,{children:"TUYA_OPENSDK_AUTHKEY"})," in ",(0,r.jsx)(t.code,{children:"apps/tuya_cloud/switch_demo/src/tuya_config.h"}),". For how to obtain authorization information, see: ",(0,r.jsx)(t.a,{href:"/docs/quick-start/#tuyaopen-authorization-code-acquisition",children:"TuyaOpen Authorization Code Acquisition"})]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["For cellular and wired network platform adaptation, you need to bind the device by scanning the QR code with the ",(0,r.jsx)(t.strong,{children:"Smart Life"})," or ",(0,r.jsx)(t.strong,{children:"Tuya"})," APP. ",(0,r.jsx)(t.a,{href:"/docs/quick-start/device-network-configuration#download-app",children:"Click here to see how to download and use the APP"}),". The QR code link can be printed using the following code:"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.code,{children:"apps/tuya_cloud/switch_demo/src/tuya_main.c:107"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-c",children:'char buffer[255];\nsnprintf(buffer, sizeof(buffer), "https://smartapp.tuya.com/s/p?p=%s&uuid=%s&v=2.0", TUYA_PRODUCT_ID,\n         license.uuid);\nPR_INFO("QR link: %s", buffer);\n'})}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:function(e,t,n){n.d(t,{R:()=>o,x:()=>s});var a=n(6540);let r={},i=a.createContext(r);function o(e){let t=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),a.createElement(i.Provider,{value:t},e.children)}}}]);