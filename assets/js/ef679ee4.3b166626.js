"use strict";(self.webpackChunktuyaopen_io_website=self.webpackChunktuyaopen_io_website||[]).push([["9007"],{3858:function(e,n,i){i.r(n),i.d(n,{metadata:()=>t,default:()=>h,frontMatter:()=>r,contentTitle:()=>o,toc:()=>l,assets:()=>d});var t=JSON.parse('{"id":"contribute/coding-style-guide","title":"Coding Style Guide","description":"This style guide aims to encourage TuyaOpen developers to adopt unified coding conventions, improving code readability and maintainability.","source":"@site/docs/contribute/coding-style-guide.md","sourceDirName":"contribute","slug":"/contribute/coding-style-guide","permalink":"/docs/contribute/coding-style-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/Tuya-Community/TuyaOpen.io/edit/master/docs/contribute/coding-style-guide.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Contribution Guide","permalink":"/docs/contribute/contribute-guide"},"next":{"title":"Quick Guide to Markdown Syntax","permalink":"/docs/contribute/template/markdown-syntax"}}'),s=i(4848),a=i(8453);let r={},o="Coding Style Guide",d={},l=[{value:"Directories and Files",id:"directories-and-files",level:2},{value:"Header Files",id:"header-files",level:3},{value:"File Header Description",id:"file-header-description",level:3},{value:"Functions",id:"functions",level:2},{value:"Function Naming",id:"function-naming",level:3},{value:"Input Parameters",id:"input-parameters",level:3},{value:"Return Values",id:"return-values",level:3},{value:"Function Declaration",id:"function-declaration",level:3},{value:"Comments",id:"comments",level:3},{value:"Indentation",id:"indentation",level:2},{value:"Spaces and Parentheses",id:"spaces-and-parentheses",level:3},{value:"Loops",id:"loops",level:3},{value:"Do-While",id:"do-while",level:3},{value:"Conditional Statements",id:"conditional-statements",level:3},{value:"if-else if-else statements",id:"if-else-if-else-statements",level:3},{value:"Switch-Case",id:"switch-case",level:3},{value:"Macros and Enums",id:"macros-and-enums",level:2},{value:"Code Formatting",id:"code-formatting",level:2},{value:"Manual formatting:",id:"manual-formatting",level:3},{value:"Automatic formatting:",id:"automatic-formatting",level:3}];function c(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"coding-style-guide",children:"Coding Style Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This style guide aims to encourage TuyaOpen developers to adopt unified coding conventions, improving code readability and maintainability."}),"\n",(0,s.jsxs)(n.p,{children:["TuyaOpen's coding style is based on the ",(0,s.jsx)(n.a,{href:"https://www.kernel.org/doc/html/latest/process/coding-style.html",children:"Linux kernel coding style"})," with some modifications and simplifications."]}),"\n",(0,s.jsx)(n.h2,{id:"directories-and-files",children:"Directories and Files"}),"\n",(0,s.jsx)(n.p,{children:'Both directories and files should be named in lowercase, with names reflecting the content they represent. For commands combining multiple meanings, use an underscore "_" to connect them. It is recommended that directory and file names do not exceed three combined components.'}),"\n",(0,s.jsx)(n.h3,{id:"header-files",children:"Header Files"}),"\n",(0,s.jsx)(n.p,{children:"C language header files should define a symbol to avoid multiple inclusions. The definition style should be as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:'#ifndef __TCP_TRANSPORTER_H__\n#define __TCP_TRANSPORTER_H__\n\n#ifdef __cplusplus\nextern "C" {\n#endif\n\n...\n\n#ifdef __cplusplus\n} // extern "C"\n#endif\n\n#endif /* __TCP_TRANSPORTER_H__ */\n'})}),"\n",(0,s.jsx)(n.p,{children:'Macro names should be consistent with file names, using uppercase letters, starting and ending with double underscores "__", and converting all non-alphabetic symbols to underscores.'}),"\n",(0,s.jsx)(n.p,{children:'To ensure that C functions work correctly in a C++ environment, use the extern "C" macro in header files to ensure the determinism of function declarations.'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:'#ifdef __cplusplus\nextern "C" {\n#endif\n\n#ifdef __cplusplus\n}\n#endif\n'})}),"\n",(0,s.jsx)(n.p,{children:"All content in header files must be placed within macro protection areas."}),"\n",(0,s.jsx)(n.h3,{id:"file-header-description",children:"File Header Description"}),"\n",(0,s.jsx)(n.p,{children:"File headers should include descriptive comments describing the file's description, version, copyright, etc."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"/**\n * @file tcp_transporter.h\n * @brief Header file for TCP transporter functions.\n *\n * This file declares the interface for creating and destroying TCP transporters\n * within the Tuya AI+IoT SDK. A TCP transporter is responsible for establishing\n * and managing TCP connections, enabling the transmission of data between Tuya\n * devices and the Tuya cloud platform or other networked services. The\n * functions provided here allow for the creation of a TCP transporter instance\n * and its subsequent destruction, facilitating clean resource management and\n * termination of TCP connections.\n *\n * The creation function initializes a new TCP transporter and returns a handle\n * for further operations, while the destruction function releases any resources\n * allocated to the TCP transporter and properly closes the TCP connection.\n *\n * @copyright Copyright (c) 2021-2024 Tuya Inc. All Rights Reserved.\n *\n */\n"})}),"\n",(0,s.jsx)(n.h2,{id:"functions",children:"Functions"}),"\n",(0,s.jsx)(n.h3,{id:"function-naming",children:"Function Naming"}),"\n",(0,s.jsxs)(n.p,{children:['Function names should be composed of lowercase letters and underscores, with words connected by "_". Commands should follow the subject-verb structure, such as ',(0,s.jsx)(n.code,{children:"set_xxx"}),", ",(0,s.jsx)(n.code,{children:"get_xxx"}),"."]}),"\n",(0,s.jsx)(n.p,{children:'Module internal function interfaces should start with double underscores "__" and are recommended to be declared as static:'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"static void __function(void)\n{\n    ...\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"input-parameters",children:"Input Parameters"}),"\n",(0,s.jsx)(n.p,{children:"If the function entry parameters are empty, void must be used as the entry parameter."}),"\n",(0,s.jsx)(n.h3,{id:"return-values",children:"Return Values"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Functions must specify return values;"}),"\n",(0,s.jsx)(n.li,{children:"For functions with clear return values, the return values of called functions must be checked, and exceptions must be handled;"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:'static OPERATE_RET function(void)\n{\n    char *out = NULL;\n\n    out = tal_malloc(128);\n    if (NULL == out) {\n        PR_ERR("tal_malloc Fails %d", len);\n        return OPRT_MALLOC_FAILED;\n    }\n    \n    ...\n    \n    return OPRT_OK;\n}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Return values and names should be kept on the same line, and if a line break is needed, it should maintain a reasonable alignment."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"function-declaration",children:"Function Declaration"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"API interfaces provided for external use must be declared in the corresponding header file;"}),"\n",(0,s.jsx)(n.li,{children:"Function declarations can be obtained through header file references, rather than using the extern way; it is advisable to avoid using extern for functions."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"comments",children:"Comments"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Good code should be self-descriptive, but not every coder can achieve this. It is recommended that code should include rich comments to help us record, understand, and track the code."}),"\n",(0,s.jsx)(n.li,{children:"External interfaces should be declared in the header file and provide detailed comments, describing the function's functionality, parameters, and return values."}),"\n",(0,s.jsx)(n.li,{children:"Function header comments should help understand the function's purpose, parameter usage, and how to handle return values, helping users understand how to use the function and understand the issues and risks it may have in special scenarios."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"/**\n * @brief Controls the TLS transporter.\n *\n * This function is used to control the TLS transporter by sending different\n * commands.\n *\n * @param t The TLS transporter to control.\n * @param cmd The command to send.\n * @param args The arguments for the command.\n *\n * @return The result of the operation.\n */\n"})}),"\n",(0,s.jsx)(n.p,{children:"Where:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"@brief + Briefly describe the function's purpose. In the description, emphasize the function's purpose, capitalize the first letter of each sentence, and end with an English period."}),"\n",(0,s.jsx)(n.li,{children:"Function description. Points about the function's functionality or purpose that were not covered in the brief description can be explained, with each sentence starting with a capital letter and ending with an English period."}),"\n",(0,s.jsx)(n.li,{children:"@param + Use the parameter as the subject + be verb + describe, explaining the meaning or source of the parameter."}),"\n",(0,s.jsx)(n.li,{children:"@return + Enumerate return values + describe the meaning of the return value. If the return value is data, directly introduce the function of the data."}),"\n",(0,s.jsx)(n.li,{children:"@warning + Points to note when using the function. In the use of the function, describe the points to note, such as the use environment and use method. Each sentence starts with a capital letter and ends with an English period."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"indentation",children:"Indentation"}),"\n",(0,s.jsx)(n.p,{children:"We use the K&R indentation style."}),"\n",(0,s.jsx)(n.h3,{id:"spaces-and-parentheses",children:"Spaces and Parentheses"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Program blocks should be written in indentation style, with each level of indentation being 4 spaces, and consistency should be maintained."}),"\n",(0,s.jsx)(n.li,{children:"Add a space after keywords, and do not add spaces after left parentheses and before right parentheses:"}),"\n",(0,s.jsx)(n.li,{children:"Left braces and conditions, loop conditions should be on the same line"}),"\n",(0,s.jsx)(n.li,{children:"Right braces should be on a separate line (except for do-while and if-else if)"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"if (condition) {\n    action();\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"loops",children:"Loops"}),"\n",(0,s.jsx)(n.p,{children:"For loops should follow the indentation standard of functions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"int i = 0;\nfor (i = 0; i < MAX; i++) { \n    do_something();\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"do-while",children:"Do-While"}),"\n",(0,s.jsx)(n.p,{children:"The left brace should immediately follow the do keyword and be indented by one space; the right brace and the while keyword should be on the same line and be indented by one space."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"do {\n    body of do-loop\n} while (condition);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"conditional-statements",children:"Conditional Statements"}),"\n",(0,s.jsx)(n.p,{children:"In a condition or loop with more than one statement, braces should also be used:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"if (condition) {\n    if (test) {\n        do_something();\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"if-else-if-else-statements",children:"if-else if-else statements"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"if (x == y) {\n    ..\n} else if (x > y) {\n    ...\n} else {\n    ....\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"switch-case",children:"Switch-Case"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Each case should be on its own line, and cases should be aligned with the switch."}),"\n",(0,s.jsx)(n.li,{children:"Each case's execution body should be protected with braces, to avoid variables exceeding their scope."}),"\n",(0,s.jsx)(n.li,{children:"Do not forget the default."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"switch (suffix) { \ncase 'A': \ncase 'a': \n    {\n        printf(\"a\"); \n    }\n    break; \ncase 'B': \ncase 'b': \n    {\n        printf(\"b\");  \n    }\n    break; \n/* fall through */ \ndefault: \n    break; \n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"macros-and-enums",children:"Macros and Enums"}),"\n",(0,s.jsx)(n.p,{children:'Use uppercase with underscores:\nMacro names and labels in enums should all be in uppercase letters, with words connected by "_".'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"#define CONSTANT 0x12345\n"})}),"\n",(0,s.jsx)(n.p,{children:"Prefer enums for related constants:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-c",children:"typedef enum {\n    STATE_IDLE,\n    STATE_START,\n    STATE_DATA_LOAD,\n    STATE_ENDPOINT_GET,\n    STATE_ENDPOINT_UPDATE,\n    STATE_TOKEN_PENDING,\n    STATE_ACTIVATING,\n    STATE_NETWORK_CHECK,\n    STATE_NETWORK_RECONNECT,\n    STATE_STARTUP_UPDATE,\n    STATE_MQTT_CONNECT_START,\n    STATE_MQTT_CONNECTING,\n    STATE_MQTT_RECONNECT,\n    STATE_MQTT_YIELD,\n    STATE_RESTART,\n    STATE_RESET,\n    STATE_STOP,\n    STATE_EXIT,\n} tuya_run_state_t;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"code-formatting",children:"Code Formatting"}),"\n",(0,s.jsx)(n.p,{children:"TuyaOpen supports code formatting with clang-format. Please install clang-format 14 or above, and manually or automatically format the code currently modified."}),"\n",(0,s.jsx)(n.h3,{id:"manual-formatting",children:"Manual formatting:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ clang-format -style=file -i <file>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Where ",(0,s.jsx)(n.code,{children:"<file>"})," is the file to be formatted."]}),"\n",(0,s.jsx)(n.h3,{id:"automatic-formatting",children:"Automatic formatting:"}),"\n",(0,s.jsxs)(n.p,{children:["The TuyaOpen directory ",(0,s.jsx)(n.code,{children:"tools/hooks/pre-commit"})," file will be automatically copied to the ",(0,s.jsx)(n.code,{children:".git/hooks"})," directory during compilation."]}),"\n",(0,s.jsxs)(n.p,{children:["The pre-commit command will automatically call clang-format to format the files that have already been added with the ",(0,s.jsx)(n.code,{children:"git add"})," command when committing code with the ",(0,s.jsx)(n.code,{children:"git commit"})," command."]})]})}function h(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:function(e,n,i){i.d(n,{R:()=>r,x:()=>o});var t=i(6540);let s={},a=t.createContext(s);function r(e){let n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);